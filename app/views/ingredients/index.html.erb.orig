<div  data-controller="search">
  <h1> <%= current_user.name %>'s Pantry </h1>
  <div class="expiring-alert" data-controller="alert" data-alert-target="container">
    <% if @expiring.present? && @expiring.any? %>
        <i class="fa-solid fa-circle-exclamation fa-xl"
            style="color: #FA9185;"
            data-alert-target="icon"
            data-action="mouseenter->alert#reopenMessage click->alert#reopenMessage"></i>
      <div class="expiring-message" data-alert-target="message">
        <%= link_to expiring_ingredients_path, style: "text-decoration: none; color: white;" do %>
          <%= @expiring.length %> items expiring soon!
        <% end %>
      </div>
    <% end %>
  </div>
  <!--<div data-controller="toggler">
    <button data-action="toggler#toggle" data-target-name="form"> Stock the pantry! </button>
    <%# Added ternary operate to keep form rendered if there were errors on entry %>
    <div data-toggler-target="form" class="<%= @ingredient.errors.any? ? '' : 'd-none' %>">
      <%= render partial: "form"%>
    </div>
  </div>-->
  <%# Div for filter buttons %>
  <div class="buttons-filter" data-controller="filtering">
    <%# Adding button to render all categories %>
    <button
      class="btn-filter"
      data-action="filtering#showAll"
      data-filtering-target="button">
      All
      </button>
    <% @categories.each do |category| %>
      <button
        class="btn-filter"
        data-action="filtering#fire"
        data-filtering-target="button"
        data-category="<%= category.name %>">
        <%= category.name %>
      </button>
    <% end %>
  </div>

<%# ajax search %>
  <%# <form id="search-ingredients" data-controller="search">
    <div class="form-group  m-1">
      <div class="d-flex">
        <input type="text" id="ingredient-name" class="form-control"
          data-action="keyup->search#fire"
          data-search-target="input"
          placeholder="stimulus search">
        <input type="submit" data-search-target="submit->search#fire" value="Search" class="btn btn-primary ms-2">
      </div>
    </div>
  </form> %>
    <%# </div> %>


<%# Plain simple search %>
    <div class="col-sm-8 my-3 m-1" data-controller="search">
      <%= form_with url: ingredients_path, method: :get, data: { search_target: "input" }, class: "d-flex" do %>
        <%= text_field_tag :query,
          params[:query],
          class: "form-control",
          placeholder: "Search your Pantry",
          data: { action: "keyup->search#fire" }
        %>
<<<<<<< HEAD
        <%= submit_tag "Search", name: "", class: "btn btn-primary" %>
      <% end %>
    </div>

<turbo-frame id="search-results">
  <!-- Search results will be injected here -->
</turbo-frame>

  <div id="expiring">

    <%# Filters for items expiring in the next 7 days; may need to expand that range %>
    <% expiring = @ingredients.select do |ingredient| %>
      <% ingredient.expiration_date.present? && ingredient.expiration_date <= (Date.today + 7) %>
    <% end %>
    <%# Conditional Guard -- Hides expiring section if expiring array is empty %>
    <% if expiring.any? %>
      <div class="expiring-section">
        <div class="category-title expiring-title">
          <div class="recycle-container">
            <div class="pie-chart"></div>
            <div class="recycle-overlay"><i class="fa-solid fa-recycle"></i></div>
          </div>
          <h3> Expiring soon! </h3>
        <%# Rotating recycle icon %>
          <div class="recycle-container">
            <div class="pie-chart"></div>
            <div class="recycle-overlay"><i class="fa-solid fa-recycle"></i></div>
          </div>
        </div>
          <% expiring.each do |ingredient| %>
            <%= render partial: "ingredients_card", locals: { ingredient: ingredient } %>
          <% end %>
      </div>
    <% end %>
  </div>

  <%# <ul data-search-target="results">is this working</ul> %>

=======
      <%= submit_tag "Search", name: "", class: "btn btn-primary" %>
    <% end %>
  </div>
>>>>>>> master
  <div data-controller="filtering">
    <% @categories.each do |category| %>
      <%# Isolates ingredients of that category belonging to the current pantry / user %>
      <% category_ingredients = @ingredients.select { |ingredient| ingredient.category == category } %>
      <%# Hides categories if nothing has been added to it yet %>
      <% if category_ingredients.any? %>
        <%# Using empty class "category-section" to help filtering Stimulus controller. DO NOT DELETE %>
        <div data-category="<%= category.name %>" class="category-section">
          <%= render partial: "category", locals: { category: category, ingredients: @ingredients } %>
        </div>
        <% end %>
    <% end %>
  </div>
</div>
